
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Elaboración de Horarios</title>

    <link href="css/bootstrap.css" rel="stylesheet">

    <link href="css/signin.css" rel="stylesheet">

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
<style>
.hora{
  background-color:#777;
}
.hora-activa{
  background-color: #fff;
  cursor:pointer;
}
.con-curso{
  background-color: #ccc;
}
</style>
  </head>

  <body>
<div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
        <div class="list-group profesores">
          <a href="#" class="list-group-item active">Elige un Profesor</a>
        </div>
    </div>
  </div>
</div>

    <div class="container">
      <div class="row" style="text-align:center;">
        <select>
            <option>Seleccione un ciclo</option>
            <option>Ciclo I</option>
            <option>Ciclo II</option>
            <option>Ciclo III</option>
            <option>Ciclo IV</option>
            <option>Ciclo V</option>
            <option>Ciclo VI</option>
            <option>Ciclo VII</option>
            <option>Ciclo VIII</option>
            <option>Ciclo IX</option>
            <option>Ciclo X</option>
        </select>
      </div>
      <br clear="all" />
      <div class="row">
        <div class="col-md-2 cursos"></div>
        <div class="col-md-7">
           <table class="table table-striped table-bordered">
              <tr>
                  <th>Horas</th>
                  <th>Lunes</th>
                  <th>Martes</th>
                  <th>Miércoles</th>
                  <th>Jueves</th>
                  <th>Viernes</th>
                  <th>Sábado</th>
                  <th>Domingo</th>
              </tr>
              <tr>
                  <td>8:00 - 8:45</td>
                  <td class="hora" hora-data="1-1"></td>
                  <td class="hora" hora-data="2-1"></td>
                  <td class="hora" hora-data="3-1"></td>
                  <td class="hora" hora-data="4-1"></td>
                  <td class="hora" hora-data="5-1"></td>
                  <td class="hora" hora-data="6-1"></td>
                  <td class="hora" hora-data="7-1"></td>
              </tr>
              <tr>
                  <td>8:45 - 9:30</td>
                  <td class="hora" hora-data="1-2"></td>
                  <td class="hora" hora-data="2-2"></td>
                  <td class="hora" hora-data="3-2"></td>
                  <td class="hora" hora-data="4-2"></td>
                  <td class="hora" hora-data="5-2"></td>
                  <td class="hora" hora-data="6-2"></td>
                  <td class="hora" hora-data="7-2"></td>
              </tr>
              <tr>
                  <td>9:30 - 10:15</td>
                  <td class="hora" hora-data="1-3"></td>
                  <td class="hora" hora-data="2-3"></td>
                  <td class="hora" hora-data="3-3"></td>
                  <td class="hora" hora-data="4-3"></td>
                  <td class="hora" hora-data="5-3"></td>
                  <td class="hora" hora-data="6-3"></td>
                  <td class="hora" hora-data="7-3"></td>
              </tr>
              <tr>
                  <td>10:15 - 11:00</td>
                  <td class="hora" hora-data="1-4"></td>
                  <td class="hora" hora-data="2-4"></td>
                  <td class="hora" hora-data="3-4"></td>
                  <td class="hora" hora-data="4-4"></td>
                  <td class="hora" hora-data="5-4"></td>
                  <td class="hora" hora-data="6-4"></td>
                  <td class="hora" hora-data="7-4"></td>
              </tr>
              <tr>
                  <td>11:00- 11:45</td>
                  <td class="hora" hora-data="1-5"></td>
                  <td class="hora" hora-data="2-5"></td>
                  <td class="hora" hora-data="3-5"></td>
                  <td class="hora" hora-data="4-5"></td>
                  <td class="hora" hora-data="5-5"></td>
                  <td class="hora" hora-data="6-5"></td>
                  <td class="hora" hora-data="7-5"></td>
              </tr>
              <tr>
                  <td>11:45 - 12:30</td>
                  <td class="hora" hora-data="1-6"></td>
                  <td class="hora" hora-data="2-6"></td>
                  <td class="hora" hora-data="3-6"></td>
                  <td class="hora" hora-data="4-6"></td>
                  <td class="hora" hora-data="5-6"></td>
                  <td class="hora" hora-data="6-6"></td>
                  <td class="hora" hora-data="7-6"></td>
              </tr>
              <tr>
                  <td>12:30 - 1:15</td>
                  <td class="hora" hora-data="1-7"></td>
                  <td class="hora" hora-data="2-7"></td>
                  <td class="hora" hora-data="3-7"></td>
                  <td class="hora" hora-data="4-7"></td>
                  <td class="hora" hora-data="5-7"></td>
                  <td class="hora" hora-data="6-7"></td>
                  <td class="hora" hora-data="7-7"></td>
              </tr>
              <tr>
                  <td>1:15 - 2:00</td>
                  <td class="hora" hora-data="1-8"></td>
                  <td class="hora" hora-data="2-8"></td>
                  <td class="hora" hora-data="3-8"></td>
                  <td class="hora" hora-data="4-8"></td>
                  <td class="hora" hora-data="5-8"></td>
                  <td class="hora" hora-data="6-8"></td>
                  <td class="hora" hora-data="7-8"></td>
              </tr>
              <tr>
                  <td>2:00- 2:45</td>
                  <td class="hora" hora-data="1-9"></td>
                  <td class="hora" hora-data="2-9"></td>
                  <td class="hora" hora-data="3-9"></td>
                  <td class="hora" hora-data="4-9"></td>
                  <td class="hora" hora-data="5-9"></td>
                  <td class="hora" hora-data="6-9"></td>
                  <td class="hora" hora-data="7-9"></td>
              </tr>
              <tr>
                  <td>2:45 - 3:30</td>
                  <td class="hora" hora-data="1-10"></td>
                  <td class="hora" hora-data="2-10"></td>
                  <td class="hora" hora-data="3-10"></td>
                  <td class="hora" hora-data="4-10"></td>
                  <td class="hora" hora-data="5-10"></td>
                  <td class="hora" hora-data="6-10"></td>
                  <td class="hora" hora-data="7-10"></td>
              </tr>
              <tr>
                  <td>3:30 - 4:15</td>
                  <td class="hora" hora-data="1-11"></td>
                  <td class="hora" hora-data="2-11"></td>
                  <td class="hora" hora-data="3-11"></td>
                  <td class="hora" hora-data="4-11"></td>
                  <td class="hora" hora-data="5-11"></td>
                  <td class="hora" hora-data="6-11"></td>
                  <td class="hora" hora-data="7-11"></td>
              </tr>
              <tr>
                  <td>4:15 - 5:00</td>
                  <td class="hora" hora-data="1-12"></td>
                  <td class="hora" hora-data="2-12"></td>
                  <td class="hora" hora-data="3-12"></td>
                  <td class="hora" hora-data="4-12"></td>
                  <td class="hora" hora-data="5-12"></td>
                  <td class="hora" hora-data="6-12"></td>
                  <td class="hora" hora-data="7-12"></td>
              </tr>
              <tr>
                  <td>5:00 - 5:45</td>
                  <td class="hora" hora-data="1-13"></td>
                  <td class="hora" hora-data="2-13"></td>
                  <td class="hora" hora-data="3-13"></td>
                  <td class="hora" hora-data="4-13"></td>
                  <td class="hora" hora-data="5-13"></td>
                  <td class="hora" hora-data="6-13"></td>
                  <td class="hora" hora-data="7-13"></td>
              </tr>
              <tr>
                  <td>5:45 - 6:30</td>
                  <td class="hora" hora-data="1-14"></td>
                  <td class="hora" hora-data="2-14"></td>
                  <td class="hora" hora-data="3-14"></td>
                  <td class="hora" hora-data="4-14"></td>
                  <td class="hora" hora-data="5-14"></td>
                  <td class="hora" hora-data="6-14"></td>
                  <td class="hora" hora-data="7-14"></td>
              </tr>
              <tr>
                  <td>6:30 - 7:15</td>
                  <td class="hora" hora-data="1-15"></td>
                  <td class="hora" hora-data="2-15"></td>
                  <td class="hora" hora-data="3-15"></td>
                  <td class="hora" hora-data="4-15"></td>
                  <td class="hora" hora-data="5-15"></td>
                  <td class="hora" hora-data="6-15"></td>
                  <td class="hora" hora-data="7-15"></td>
              </tr>
              <tr>
                  <td>7:15 - 8:00</td>
                  <td class="hora" hora-data="1-16"></td>
                  <td class="hora" hora-data="2-16"></td>
                  <td class="hora" hora-data="3-16"></td>
                  <td class="hora" hora-data="4-16"></td>
                  <td class="hora" hora-data="5-16"></td>
                  <td class="hora" hora-data="6-16"></td>
                  <td class="hora" hora-data="7-16"></td>
              </tr>
              <tr>
                  <td>8:00 - 8:45</td>
                  <td class="hora" hora-data="1-17"></td>
                  <td class="hora" hora-data="2-17"></td>
                  <td class="hora" hora-data="3-17"></td>
                  <td class="hora" hora-data="4-17"></td>
                  <td class="hora" hora-data="5-17"></td>
                  <td class="hora" hora-data="6-17"></td>
                  <td class="hora" hora-data="7-17"></td>
              </tr>
              <tr>
                  <td>8:45 - 9:30</td>
                  <td class="hora" hora-data="1-18"></td>
                  <td class="hora" hora-data="2-18"></td>
                  <td class="hora" hora-data="3-18"></td>
                  <td class="hora" hora-data="4-18"></td>
                  <td class="hora" hora-data="5-18"></td>
                  <td class="hora" hora-data="6-18"></td>
                  <td class="hora" hora-data="7-18"></td>
              </tr>
              <tr>
                  <td>9:30 - 10:15</td>
                  <td class="hora" hora-data="1-19"></td>
                  <td class="hora" hora-data="2-19"></td>
                  <td class="hora" hora-data="3-19"></td>
                  <td class="hora" hora-data="4-19"></td>
                  <td class="hora" hora-data="5-19"></td>
                  <td class="hora" hora-data="6-19"></td>
                  <td class="hora" hora-data="7-19"></td>
              </tr>
           </table>
        </div>
        <div class="col-md-2">
            <div class="row">
                <table class="table table-bordered table-striped">
                  <tr>
                    <th>Curso - Sección</th>
                    <td class="curso-tabla"></td>
                  </tr>
                  <tr>
                    <th>Horas de curso</th>
                    <td class="hora-curso-tabla"></td>
                  </tr>
                  <tr>
                    <th>Profesor seleccionado</th>
                    <td class="profe-tabla"></td>
                  </tr>
                  <tr>
                    <th>Horas disponibles del profesor</th>
                    <td class="hora-profe-tabla"></td>
                  </tr>
                </table>
            </div>
        </div>
      </div>
      <div class="row" style="text-align:right">
          <button>Guardar Versión</button>
          <button>Desechar</button>
      </div>
    </div> <!-- /container -->

<script type="text/javascript">
var json = '{"cursos":{"1":{"seccion":"ingles - 32C","horas":"4","profesores":{"0":{"nombre":"Sebastian Burgos","disponibilidad":{"0":"1-19","1":"1-18","2":"1-17","3":"2-19","4":"2-18"}},"1":{"nombre":"ABC DEFG","disponibilidad":{"0":"4-9","1":"4-10","2":"4-11"}}}},"2":{"seccion":"Frances - 32C","horas":"1","profesores":{"0":{"nombre":"Qwerty Perez","disponibilidad":{"0":"6-19","1":"6-18","2":"6-17","3":"5-19","4":"5-18"}},"1":{"nombre":"Ollanta Humala","disponibilidad":{"0":"2-9","1":"2-10","2":"2-11"}}}}}}';
var obj = JSON.parse(json);

$.each(obj.cursos, function(i, curso){
  html = '<div class="btn btn-success curso" curso-id="'+i+'" data-toggle="modal" data-target=".bs-example-modal-sm">'+curso.seccion+'</div>';
  $(".cursos").append(html);
});

var id = 0;
var horas = 0;
var nombre = '';
$(".curso").on("click", function(){
  id = $(this).attr("curso-id");
  objCurso = GetObjectKeyIndex(obj.cursos, id);
  $(".curso-tabla").html(objCurso.seccion);

  $(".profesores").html('<a href="#" class="list-group-item active">Elige un Profesor</a>');
  $.each(objCurso.profesores, function(i, o){
      profe = '<a href="#" class="list-group-item profe" onclick="profeHorario('+i+', '+id+')">'+o.nombre+'</a>';
      $(".profesores").append(profe);
  });
});

function profeHorario(profe, curso)
{
  $('#myModal').modal('hide');
  objCurso = GetObjectKeyIndex(obj.cursos, curso); 
  objProfe = GetObjectKeyIndex(objCurso.profesores, profe);  

  horas = objCurso.horas;
  nombre = objCurso.seccion;

  $(".hora-curso-tabla").html(horas);
  $(".profe-tabla").html(objProfe.nombre);
  
  horasProfe = 0;
  $(".hora").removeClass("hora-activa");
  $.each(objProfe.disponibilidad, function(key, value){
    $(".hora").each(function(index){
        if(value == $(this).attr("hora-data"))
        {
          $(this).addClass("hora-activa");
          horasProfe++;
        }
    });
  }); 
  $(".hora-profe-tabla").html(horasProfe+'');
}

$(".hora").on("click", function(){
  if($(this).attr("class") == 'hora hora-activa')
  {
    if(horas > 0)
    {
      $(this).html(nombre);
      $(this).addClass("con-curso");
      horas--;
    }
  }
  else if($(this).attr("class") == 'hora hora-activa con-curso')
  {
     $(this).html("");
     $(this).removeClass("con-curso");
     horas++;
  }
});

function GetObjectKeyIndex(obj, keyToFind) {
  var r = null;
  $.each(obj, function(i, o){
      if(i == keyToFind)
      {
        r = o;
      }
  });
    return r;
}
</script>
  </body>
</html>
